<!DOCTYPE html>

<html lang="en-US">

<head>
  <title>Meyerson</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://unpkg.com/vue@3"></script>
  <link rel="stylesheet" href="index.css">
  <script src="/index.js" defer></script>
  <!--<script defer>Vue.createApp(app).mount("#app");</script>-->
</head>

<body>
  <div id="app">
    <h1 class="center-text">Meyerson</h1>

    <div id="main">
      <details class="center-text">
        <summary>Help</summary>
        <p>
        <b>Stdout/stderr Filenames</b>
        <p style="text-align:left">
        <br />
        "-" means the file is named process[num]-std[out/err].txt where [num] is the process number and [out/err] depends on whether the output is stdout or stderr.
        <br />
        "%" means the file is named process[name]-std[out/err].txt where [name] is the process name.
        <br />
        If the filename is blank, the output isn't captured.
        </p>
        </p>
      </details>
      <div style="marign-bottom:5px">
        <button @click="startNewProc" v-if="!editing">New Process</button>
        <button @click="editing=false" v-else>Cancel</button>
      </div>
      <div id="new-proc-div" v-if="editing" style="margin-bottom:5px">
        <div>
          <label for="name">Name:</label>
          <input type="text" name="name" v-model="proc.name"/>
        </div>

        <div>
          <label for="program">Program:</label>
          <input type="text" name="program" v-model="proc.program" />
        </div>

        <div>
          <p style="margin:none">Args:</p>
          <button @click="proc.args.push('')">New Arg</button>
          <div v-for="(arg, i) in proc.args">
            <input type="text" v-model="proc.args[i]" />
            <button @click="proc.args.splice(i, 1)">X</button>
          </div>
        </div>

        <div>
          <p style="margin:none">Env:</p>
          <button @click="proc.env.push('')">New Envvar</button>
          <div v-for="(env, i) in proc.env">
            <input type="text" v-model="proc.env[i]" />
            <button @click="proc.env.splice(i, 1)">X</button>
          </div>
        </div>

        <div>
          <label for="dir">Dir:</label>
          <input type="text" name="dir" v-model="proc.dir" />
        </div>

        <div>
          <label for="outFilename">Stdout Filename:</label>
          <input type="text" name="outFilename" v-model="proc.outFilename" />
        </div>

        <div>
          <label for="errFilename">Stderr Filename:</label>
          <input type="text" name="errFilename" v-model="proc.errFilename" />
        </div>

        <div>
          <button @click="addProc">Add</button>
          <button @click="clearProc">Clear</button>
        </div>
      </div>
      <div id="global-env-div" style="margin-bottom:5px">
        <button
          @click="showingGlobalEnv=!showingGlobalEnv"
        >Show Global Env</button>
        <div v-if="showingGlobalEnv">
          <p v-for="ev in globalEnv">{{ev}}</p>
        </div>
      </div>
      <div id="procs-div">
        <div>
          <button @click="refreshProcs">Refresh</button>
          <button 
            v-if="detailsShowing"
            @click="collapseExpandDetails"
          >Collapse All</button>
          <button 
            v-else
            @click="collapseExpandDetails"
          >Expand All</button>
        </div>
        <details v-for="proc in procs" class="center-text proc-details">
          <summary>
            Process {{proc.num}} | {{proc.name}} | {{proc.status}}
          </summary>
          <p>
          Program: {{proc.program}}
          <br />
          Dir: {{proc.dir}}
          <br />
          Args:<br />{{proc.args}}
          <br />
          Env:<br />{{proc.env}}
          <br />
          <a 
            v-if="proc.outFilename" target="_blank" :href="`/stdout/${proc.num}`"
            >Stdout: {{proc.outFilename}}</a>
          <br />
          <a 
            v-if="proc.errFilename" target="_blank" :href="`/stderr/${proc.num}`"
            >Stderr: {{proc.errFilename}}</a>
          </p>
          <button @click="delProc(proc.num)">Delete</button>
        </details>
      </div>
    </div>
  </div>
</body>

</html>
